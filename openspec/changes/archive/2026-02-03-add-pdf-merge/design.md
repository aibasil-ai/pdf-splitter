## Context

目前專案為單頁 `index.html`，以 React 狀態管理 UI，PDF 處理由 `pdf-lib` 在瀏覽器端完成，並用 `pdf.js` 擷取文字供 AI 摘要。既有流程僅支援單檔 PDF 的切割與摘要，所有處理皆為本地端，不經伺服器。

本變更需要在相同架構下新增「多檔合併」與「單檔選頁合併」兩種合併流程，並維持使用者對於本地處理與隱私安全的期待。

## Goals / Non-Goals

**Goals:**
- 支援多個 PDF 上傳後依上傳順序合併輸出單一 PDF。
- 支援單一 PDF 指定頁碼清單合併輸出單一 PDF。
- 維持本地端處理與既有的狀態提示、錯誤訊息體驗。
- 盡量重用既有的下載與頁碼解析邏輯，降低風險。

**Non-Goals:**
- 不引入後端服務或任何上傳流程。
- 不新增頁面拖放排序、內容編輯、旋轉等進階編輯能力。
- 不處理加密/密碼保護 PDF 的解密能力（維持現況）。

## Decisions

- **延續瀏覽器端合併（PDFLib）**
  - 作法：使用 `PDFDocument.create()` 建立新文件，對每個來源 PDF `copyPages` 後依序 `addPage`。
  - 替代方案：後端合併。未採用，因為與「本地處理」定位衝突且增加維運成本。

- **在既有模式 Tabs 擴充合併模式**
  - 作法：新增 `merge-files` 與 `merge-pages` 兩個模式，並在不同模式顯示對應的上傳區與輸入區。
  - 替代方案：獨立新頁或 wizard 流程。未採用，因為目前單檔 HTML 架構更適合在同頁擴充。

- **多檔合併的資料結構與流程**
  - 作法：新增 `mergeFiles`（`File[]`）狀態，使用 `input[type=file][multiple]` 收集檔案；合併時依陣列順序逐一載入與複製頁面。
  - 顯示：在 UI 顯示檔名列表與序號，讓使用者確認合併順序；提供「清空/移除」以便重新上傳。

- **單檔選頁合併的頁碼解析**
  - 作法：共用一個頁碼解析函式，支援 `1, 3, 5` 與 `1-5` 格式；輸出順序依輸入順序，並去除重複頁（保留第一次出現）。
  - 替代方案：一律升冪排序。未採用，因為使用者可能希望保留自訂順序。

- **輸出命名與狀態提示**
  - 作法：多檔合併輸出 `merged_${檔數}_files.pdf`；選頁合併輸出 `merged_pages_${原檔名}.pdf`；沿用 `downloadBlob` 與既有 `statusMsg` 顯示成功/失敗。

## Risks / Trade-offs

- **記憶體與效能壓力** → 多檔合併會同時載入多個 PDF；以逐檔載入與處理、避免長時間保留大型 `PDFDocument` 物件來降低峰值記憶體。
- **輸入錯誤與邊界** → 頁碼超界或空輸入容易造成失敗；以清楚錯誤訊息與輸入提示降低使用門檻。
- **模式過多造成 UI 擁擠** → Tabs 增加到 5 個；以圖示與短標籤改善可讀性，必要時可考慮分組（切割 / 合併 / AI）。
- **PDF 相容性限制** → `pdf-lib` 對少數特殊 PDF 可能處理失敗；維持既有錯誤提示與重試建議。

## Migration Plan

- 更新 `index.html`（新增合併模式狀態、UI、合併邏輯）。
- 手動驗證：
  - 多檔合併（2~3 份 PDF）順序正確。
  - 單檔選頁合併（含逗號與範圍輸入）輸出頁面正確。
  - 錯誤情境（空輸入、超出頁碼）訊息正確。

## Open Questions

- 是否要支援拖放調整多檔合併順序？ 是
- 若輸入頁碼包含重複/重疊範圍，是否允許輸出重複頁？ 否
- 合併功能的主要 CTA 文字是否需要與「切割」區分更明顯？ 否
