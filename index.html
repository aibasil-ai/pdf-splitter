<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF æ™ºæ…§åˆ‡å‰²å™¨ (å–®æª”ç‰ˆ)</title>

    <!-- 1. è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. è¼‰å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- 3. è¼‰å…¥ Babel (ç”¨æ–¼åœ¨ç€è¦½å™¨ä¸­è§£æ JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. è¼‰å…¥ PDF è™•ç†ç›¸é—œåº« -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <style>
        /* è‡ªå®šç¾©å‹•ç•« */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out forwards;
        }

        body {
            font-family: 'Noto Sans TC', system-ui, -apple-system, sans-serif;
        }
    </style>
</head>

<body class="bg-slate-100 text-slate-800">
    <div id="root"></div>

    <!-- React æ‡‰ç”¨ç¨‹å¼é‚è¼¯ -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- åœ–ç¤ºçµ„ä»¶ (Inline SVGs to avoid extra dependencies) ---
        const Icon = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const Scissors = (p) => <Icon {...p}><circle cx="6" cy="6" r="3" /><circle cx="6" cy="18" r="3" /><line x1="20" x2="8.12" y1="4" y2="15.88" /><line x1="14.47" x2="20" y1="14.48" y2="20" /><line x1="8.12" x2="12" y1="8.12" y2="12" /></Icon>;
        const Upload = (p) => <Icon {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" x2="12" y1="3" y2="15" /></Icon>;
        const FileText = (p) => <Icon {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /></Icon>;
        const Layers = (p) => <Icon {...p}><polygon points="12 2 2 7 12 12 22 7 12 2" /><polyline points="2 17 12 22 22 17" /><polyline points="2 12 12 17 22 12" /></Icon>;
        const FileStack = (p) => <Icon {...p}><path d="M21 7h-3a2 2 0 0 1-2-2V2" /><path d="M21 6v6.5c0 .8-.7 1.5-1.5 1.5h-7c-.8 0-1.5-.7-1.5-1.5v-9c0-.8.7-1.5 1.5-1.5H17" /><path d="M7 8v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H15" /><path d="M3 12v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H11" /></Icon>;
        const Download = (p) => <Icon {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></Icon>;
        const Loader2 = (p) => <Icon {...p}><path d="M21 12a9 9 0 1 1-6.219-8.56" /></Icon>;
        const AlertCircle = (p) => <Icon {...p}><circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="8" y2="12" /><line x1="12" x2="12.01" y1="16" y2="16" /></Icon>;
        const CheckCircle = (p) => <Icon {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></Icon>;
        const RefreshCw = (p) => <Icon {...p}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M8 16H3v5" /></Icon>;
        const Sparkles = (p) => <Icon {...p}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /><path d="M5 3v4" /><path d="M9 3v4" /><path d="M3 5h4" /><path d="M3 9h4" /></Icon>;
        const Bot = (p) => <Icon {...p}><path d="M12 8V4H8" /><rect width="16" height="12" x="4" y="8" rx="2" /><path d="M2 14h2" /><path d="M20 14h2" /><path d="M15 13v2" /><path d="M9 13v2" /></Icon>;
        const MessageSquare = (p) => <Icon {...p}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" /></Icon>;
        const Key = (p) => <Icon {...p}><circle cx="7.5" cy="15.5" r="5.5" /><path d="m21 2-9.6 9.6" /><path d="m15.5 7.5 3 3L22 7l-3-3" /></Icon>;

        // --- é è¨­ API Key ---
        const defaultApiKey = "";

        const PDFSplitter = () => {
            const [isReady, setIsReady] = useState(false);
            const [pdfFile, setPdfFile] = useState(null);
            const [pdfDoc, setPdfDoc] = useState(null);
            const [pageCount, setPageCount] = useState(0);
            const [mode, setMode] = useState('range');

            // Inputs
            const [rangeStart, setRangeStart] = useState('');
            const [rangeEnd, setRangeEnd] = useState('');
            const [individualPages, setIndividualPages] = useState('');
            const [userApiKey, setUserApiKey] = useState(defaultApiKey);
            const [showApiKeyInput, setShowApiKeyInput] = useState(false);  // é è¨­éš±è—

            // ä½¿ç”¨æœ€æ–° Gemini æ¨¡å‹ï¼ˆ2026 å¹´ 1 æœˆï¼‰
            const [selectedModel, setSelectedModel] = useState('gemini-2.5-flash');

            // Status
            const [isProcessing, setIsProcessing] = useState(false);
            const [isAiProcessing, setIsAiProcessing] = useState(false);
            const [statusMsg, setStatusMsg] = useState({ type: '', text: '' });
            const [aiMsg, setAiMsg] = useState('');
            const [fileName, setFileName] = useState('');
            const [summaryPages, setSummaryPages] = useState(''); // æ‘˜è¦é ç¢¼è¼¸å…¥

            useEffect(() => {
                // è¨­å®š pdf.js worker
                if (window.pdfjsLib) {
                    window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                    setIsReady(true);
                } else {
                    const interval = setInterval(() => {
                        if (window.pdfjsLib) {
                            window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                            setIsReady(true);
                            clearInterval(interval);
                        }
                    }, 500);
                }
            }, []);

            const getApiKey = () => {
                return userApiKey || defaultApiKey;
            };

            const handleFileChange = async (e) => {
                const file = e.target.files?.[0];
                if (file && file.type === 'application/pdf') {
                    processFile(file);
                } else if (file) {
                    setStatusMsg({ type: 'error', text: 'è«‹ä¸Šå‚³æœ‰æ•ˆçš„ PDF æª”æ¡ˆã€‚' });
                }
            };

            const processFile = async (file) => {
                try {
                    setIsProcessing(true);
                    setStatusMsg({ type: '', text: '' });
                    setAiMsg('');

                    const arrayBuffer = await file.arrayBuffer();
                    const { PDFDocument } = window.PDFLib;
                    const loadedDoc = await PDFDocument.load(arrayBuffer);

                    setPdfDoc(loadedDoc);
                    setPageCount(loadedDoc.getPageCount());
                    setPdfFile(file);
                    setFileName(file.name);

                    setRangeStart('1');
                    setRangeEnd(loadedDoc.getPageCount().toString());
                    setIndividualPages('');

                    setIsProcessing(false);
                } catch (error) {
                    console.error(error);
                    setStatusMsg({ type: 'error', text: 'ç„¡æ³•è§£æ PDF æª”æ¡ˆï¼Œæª”æ¡ˆå¯èƒ½å·²æå£æˆ–å—å¯†ç¢¼ä¿è­·ã€‚' });
                    setIsProcessing(false);
                }
            };

            // æ ¹æ“šæŒ‡å®šé ç¢¼é™£åˆ—æå–å®Œæ•´æ–‡å­—ï¼ˆä¾›æ‘˜è¦ä½¿ç”¨ï¼‰
            const extractTextByPages = async (pageNumbers) => {
                if (!pdfFile) return null;
                try {
                    const arrayBuffer = await pdfFile.arrayBuffer();
                    const loadingTask = window.pdfjsLib.getDocument(arrayBuffer);
                    const pdf = await loadingTask.promise;

                    let extractedText = "";

                    for (const pageNum of pageNumbers) {
                        if (pageNum < 1 || pageNum > pdf.numPages) continue;

                        const page = await pdf.getPage(pageNum);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');
                        // å–æ•´é æ‰€æœ‰æ–‡å­—
                        extractedText += `[Page ${pageNum}]:\n${pageText}\n\n`;
                    }
                    return extractedText;
                } catch (e) {
                    console.error("Text extraction failed", e);
                    return null;
                }
            };

            const handleAiSummarize = async () => {
                const apiKey = getApiKey();
                if (!apiKey) {
                    setAiMsg('âš ï¸ è«‹å…ˆè¼¸å…¥ Gemini API Key æ‰èƒ½ä½¿ç”¨ AI åŠŸèƒ½ã€‚');
                    setShowApiKeyInput(true);
                    return;
                }

                // è§£ææ‘˜è¦é ç¢¼ï¼ˆæ”¯æ´å–®é å¦‚ "1, 3, 5" å’Œé€£çºŒé å¦‚ "1-5, 8-10"ï¼‰
                const parsePageInput = (input) => {
                    const pages = [];
                    const parts = input.split(/[,ï¼Œ\s]+/).filter(p => p.trim());

                    for (const part of parts) {
                        const trimmed = part.trim();
                        // æª¢æŸ¥æ˜¯å¦ç‚ºç¯„åœæ ¼å¼ (e.g., "1-5" æˆ– "1ï¼5")
                        const rangeMatch = trimmed.match(/^(\d+)[-ï¼](\d+)$/);
                        if (rangeMatch) {
                            const start = parseInt(rangeMatch[1]);
                            const end = parseInt(rangeMatch[2]);
                            if (start <= end && start >= 1 && end <= pageCount) {
                                for (let i = start; i <= end; i++) {
                                    pages.push(i);
                                }
                            }
                        } else {
                            // å–®é æ ¼å¼
                            const num = parseInt(trimmed);
                            if (!isNaN(num) && num >= 1 && num <= pageCount) {
                                pages.push(num);
                            }
                        }
                    }
                    return pages;
                };

                const pagesToSummarize = parsePageInput(summaryPages);
                const uniquePages = [...new Set(pagesToSummarize)].sort((a, b) => a - b);

                // æª¢æŸ¥æ˜¯å¦æœ‰è¼¸å…¥é ç¢¼
                if (uniquePages.length === 0) {
                    setAiMsg('âš ï¸ è«‹è¼¸å…¥è¦æ‘˜è¦çš„é ç¢¼ï¼ˆä¾‹å¦‚ï¼š1, 3, 5 æˆ– 1-5ï¼‰ã€‚');
                    return;
                }

                // æª¢æŸ¥æ˜¯å¦è¶…é 10 é 
                if (uniquePages.length > 10) {
                    setAiMsg(`âš ï¸ æ‘˜è¦æœ€å¤šåƒ…æ”¯æ´ 10 é ï¼Œæ‚¨ç›®å‰é¸æ“‡äº† ${uniquePages.length} é ã€‚è«‹æ¸›å°‘é æ•¸å¾Œå†è©¦ã€‚`);
                    return;
                }

                setIsAiProcessing(true);
                setAiMsg(`âœ¨ Gemini æ­£åœ¨é–±è®€ç¬¬ ${uniquePages.join(', ')} é çš„å®Œæ•´å…§å®¹ä¸¦é€²è¡Œæ‘˜è¦...`);

                try {
                    const textContent = await extractTextByPages(uniquePages);
                    const prompt = `
                        è«‹ç”¨ç¹é«”ä¸­æ–‡æ‘˜è¦ä»¥ä¸‹ PDF é é¢ï¼ˆç¬¬ ${uniquePages.join(', ')} é ï¼‰çš„ä¸»è¦å…§å®¹ã€‚
                        ä¿æŒç°¡æ½”ï¼Œé‡é»åˆ—å‡ºã€‚
                        å…§å®¹:
                        ${textContent}
                    `;

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${selectedModel}:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });

                    const data = await response.json();
                    if (data.error) throw new Error(data.error.message);

                    const summary = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    setAiMsg(summary || 'ç„¡æ³•ç”¢ç”Ÿæ‘˜è¦ã€‚');
                } catch (error) {
                    setAiMsg(`âš ï¸ æ‘˜è¦ç”Ÿæˆå¤±æ•—: ${error.message || 'è«‹æª¢æŸ¥ API Key æˆ–æ¨¡å‹åç¨±'}`);
                } finally {
                    setIsAiProcessing(false);
                }
            };

            const handleSplit = async () => {
                if (!pdfDoc || !window.PDFLib) return;

                setIsProcessing(true);
                setStatusMsg({ type: '', text: '' });

                try {
                    const { PDFDocument } = window.PDFLib;

                    if (mode === 'range') {
                        const start = parseInt(rangeStart);
                        const end = parseInt(rangeEnd);

                        if (isNaN(start) || isNaN(end) || start < 1 || end > pageCount || start > end) {
                            throw new Error(`è«‹è¼¸å…¥æœ‰æ•ˆçš„é é¢ç¯„åœ (1 - ${pageCount})ã€‚`);
                        }

                        const newPdf = await PDFDocument.create();
                        const pageIndices = [];
                        for (let i = start; i <= end; i++) {
                            pageIndices.push(i - 1);
                        }

                        const copiedPages = await newPdf.copyPages(pdfDoc, pageIndices);
                        copiedPages.forEach(page => newPdf.addPage(page));

                        const pdfBytes = await newPdf.save();
                        downloadBlob(pdfBytes, `split_${start}-${end}_${fileName}`, 'application/pdf');
                        setStatusMsg({ type: 'success', text: 'åˆ‡å‰²å®Œæˆï¼æª”æ¡ˆå·²ä¸‹è¼‰ã€‚' });

                    } else {
                        const pagesToExtract = individualPages.split(/[,ï¼Œ\s]+/)
                            .map(p => parseInt(p.trim()))
                            .filter(n => !isNaN(n) && n >= 1 && n <= pageCount);

                        const uniquePages = [...new Set(pagesToExtract)].sort((a, b) => a - b);

                        if (uniquePages.length === 0) {
                            throw new Error('è«‹è¼¸å…¥æœ‰æ•ˆçš„é ç¢¼ï¼Œä¸¦ç”¨é€—è™Ÿåˆ†éš”ã€‚');
                        }

                        // å¦‚æœåªæœ‰ä¸€é ï¼Œç›´æ¥ä¸‹è¼‰ PDFï¼ˆä¸ä½¿ç”¨ ZIPï¼‰
                        if (uniquePages.length === 1) {
                            const pageNum = uniquePages[0];
                            const singlePagePdf = await PDFDocument.create();
                            const [copiedPage] = await singlePagePdf.copyPages(pdfDoc, [pageNum - 1]);
                            singlePagePdf.addPage(copiedPage);
                            const bytes = await singlePagePdf.save();
                            downloadBlob(bytes, `page_${pageNum}_${fileName}`, 'application/pdf');
                            setStatusMsg({ type: 'success', text: `æˆåŠŸåˆ†å‰²ç¬¬ ${pageNum} é ï¼æª”æ¡ˆå·²ä¸‹è¼‰ã€‚` });
                        } else {
                            // å¤šé ä½¿ç”¨ ZIPï¼Œè¨­å®šå£“ç¸®ç­‰ç´šç‚º STOREï¼ˆä¸å£“ç¸®ï¼‰æ¸›å°‘é˜²æ¯’èª¤åˆ¤
                            const JSZip = window.JSZip;
                            const zip = new JSZip();

                            for (const pageNum of uniquePages) {
                                const singlePagePdf = await PDFDocument.create();
                                const [copiedPage] = await singlePagePdf.copyPages(pdfDoc, [pageNum - 1]);
                                singlePagePdf.addPage(copiedPage);
                                const bytes = await singlePagePdf.save();
                                zip.file(`page_${pageNum}.pdf`, bytes, { compression: "STORE" });
                            }

                            const zipContent = await zip.generateAsync({
                                type: "blob",
                                compression: "STORE"  // ä¸å£“ç¸®ï¼Œæ¸›å°‘é˜²æ¯’è»Ÿé«”èª¤åˆ¤
                            });
                            downloadBlob(zipContent, `split_pages_${fileName}.zip`, 'application/zip');
                            setStatusMsg({
                                type: 'success',
                                text: `æˆåŠŸåˆ†å‰² ${uniquePages.length} å€‹é é¢ï¼å·²æ‰“åŒ…ç‚º ZIP ä¸‹è¼‰ã€‚ï¼ˆè‹¥ Windows æç¤ºå®‰å…¨è­¦å‘Šï¼Œè«‹å³éµè§£é™¤å°é–ï¼‰`
                            });
                        }
                    }
                } catch (err) {
                    setStatusMsg({ type: 'error', text: err.message });
                } finally {
                    setIsProcessing(false);
                }
            };

            const downloadBlob = (data, name, mimeType) => {
                const blob = new Blob([data], { type: mimeType });
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = name;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
            };

            const reset = () => {
                setPdfFile(null);
                setPdfDoc(null);
                setPageCount(0);
                setFileName('');
                setStatusMsg({ type: '', text: '' });
                setAiMsg('');
            };

            if (!isReady) {
                return (
                    <div className="flex items-center justify-center min-h-screen bg-slate-50 text-slate-500">
                        <Loader2 className="w-8 h-8 animate-spin mr-2" />
                        <span>æ­£åœ¨åˆå§‹åŒ–ç³»çµ±...</span>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-100 to-slate-200 p-4 md:p-8 font-sans">
                    <div className="max-w-3xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
                        {/* Header */}
                        <div className="bg-indigo-600 p-6 text-white flex flex-col md:flex-row md:justify-between md:items-center gap-4">
                            <div className="flex items-center gap-3">
                                <Scissors className="w-8 h-8" />
                                <div>
                                    <h1 className="text-2xl font-bold">PDF æ™ºæ…§åˆ‡å‰²å™¨</h1>
                                    <p className="text-indigo-200 text-sm">æœ¬åœ°è™•ç† + Gemini AI (å–®æª”ç‰ˆ)</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-2">
                                <button
                                    onClick={() => setShowApiKeyInput(!showApiKeyInput)}
                                    className="text-indigo-100 hover:text-white hover:bg-indigo-500/50 p-2 rounded-lg transition-colors flex items-center gap-1 text-xs"
                                    title="è¨­å®š API Key"
                                >
                                    <Key className="w-4 h-4" />
                                    {showApiKeyInput ? 'éš±è—è¨­å®š' : 'AI è¨­å®š'}
                                </button>
                                {pdfFile && (
                                    <button
                                        onClick={reset}
                                        className="text-indigo-100 hover:text-white hover:bg-indigo-500/50 p-2 rounded-lg transition-colors"
                                        title="é‡æ–°ä¸Šå‚³"
                                    >
                                        <RefreshCw className="w-5 h-5" />
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* API Key Input Area */}
                        {showApiKeyInput && (
                            <div className="bg-indigo-50 p-4 border-b border-indigo-100 animate-fadeIn">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-xs font-bold text-indigo-700 mb-1">Google Gemini API Key</label>
                                        <input
                                            type="password"
                                            value={userApiKey}
                                            onChange={(e) => setUserApiKey(e.target.value)}
                                            placeholder="è²¼ä¸Šæ‚¨çš„ API Key..."
                                            className="w-full px-3 py-2 border border-indigo-200 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-indigo-700 mb-1">é¸æ“‡ AI æ¨¡å‹ (å·²æ›´æ–°ç‚ºæœ‰æ•ˆæ¨¡å‹)</label>
                                        <select
                                            value={selectedModel}
                                            onChange={(e) => setSelectedModel(e.target.value)}
                                            className="w-full px-3 py-2 border border-indigo-200 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none bg-white"
                                        >
                                            <option value="gemini-2.5-flash">Gemini 2.5 Flash (æ¨è–¦/ç©©å®š/å¿«é€Ÿ)</option>
                                            <option value="gemini-2.5-pro">Gemini 2.5 Pro (ç©©å®š/å¼·å¤§æ¨ç†)</option>
                                            <option value="gemini-3-flash-preview">Gemini 3 Flash Preview (æœ€æ–°/å¿«é€Ÿ)</option>
                                            <option value="gemini-3-pro-preview">Gemini 3 Pro Preview (æœ€æ–°/é€²éš)</option>
                                            <option value="gemini-2.0-flash">Gemini 2.0 Flash (ç©©å®š/é«˜æ•ˆ)</option>
                                        </select>
                                    </div>
                                </div>
                                <p className="text-[10px] text-indigo-400 mt-2">
                                    ğŸ“Œ <b>PDF åˆ‡å‰²ä¸éœ€è¦ API Key</b>ï¼Œåƒ…ã€Œ<span className="text-purple-500">AI æ‘˜è¦</span>ã€åŠŸèƒ½éœ€è¦è¼¸å…¥ã€‚æ‚¨çš„ Key ä¸æœƒè¢«å„²å­˜æ–¼ä»»ä½•ä¼ºæœå™¨ã€‚
                                </p>
                            </div>
                        )}

                        <div className="p-6 md:p-8">
                            {/* Step 1: Upload */}
                            {!pdfFile ? (
                                <div className="border-2 border-dashed border-slate-300 rounded-xl p-12 text-center hover:border-indigo-400 transition-colors bg-slate-50 relative group cursor-pointer">
                                    <input
                                        type="file"
                                        accept="application/pdf"
                                        onChange={handleFileChange}
                                        className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                    />
                                    <div className="flex flex-col items-center gap-4 pointer-events-none">
                                        <div className="w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
                                            <Upload className="w-8 h-8" />
                                        </div>
                                        <div>
                                            <p className="text-lg font-medium text-slate-700">é»æ“Šæˆ–æ‹–æ”¾ PDF æª”æ¡ˆè‡³æ­¤</p>
                                            <p className="text-slate-400 text-sm mt-1">æ”¯æ´ä»»ä½•å¤§å°çš„ PDF æ–‡ä»¶</p>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                /* Step 2: Split Controls */
                                <div className="space-y-8 animate-fadeIn">
                                    {/* File Info */}
                                    <div className="bg-slate-50 rounded-lg p-4 flex items-start md:items-center justify-between gap-4 border border-slate-200">
                                        <div className="flex items-center gap-4">
                                            <div className="w-12 h-12 bg-red-100 text-red-600 rounded-lg flex items-center justify-center shrink-0">
                                                <FileText className="w-6 h-6" />
                                            </div>
                                            <div>
                                                <h3 className="font-medium text-slate-800 break-all">{fileName}</h3>
                                                <p className="text-slate-500 text-sm flex items-center gap-2">
                                                    <Layers className="w-4 h-4" />
                                                    ç¸½é æ•¸: <span className="font-bold text-slate-700">{pageCount}</span>
                                                </p>
                                            </div>
                                        </div>
                                        <button onClick={reset} className="text-sm text-slate-400 hover:text-red-500 shrink-0 underline">
                                            æ›´æ›æª”æ¡ˆ
                                        </button>
                                    </div>

                                    {/* Mode Selection Tabs */}
                                    <div>
                                        <div className="flex border-b border-slate-200 mb-6">
                                            <button
                                                className={`pb-3 px-4 font-medium transition-colors flex items-center gap-2 ${mode === 'range' ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}
                                                onClick={() => { setMode('range'); setAiMsg(''); }}
                                            >
                                                <Layers className="w-4 h-4" />
                                                ç¯„åœåˆ‡å‰²
                                            </button>
                                            <button
                                                className={`pb-3 px-4 font-medium transition-colors flex items-center gap-2 ${mode === 'individual' ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}
                                                onClick={() => { setMode('individual'); setAiMsg(''); }}
                                            >
                                                <FileStack className="w-4 h-4" />
                                                ç¨ç«‹é é¢
                                            </button>
                                            <button
                                                className={`pb-3 px-4 font-medium transition-colors flex items-center gap-2 ${mode === 'summary' ? 'text-purple-600 border-b-2 border-purple-600' : 'text-slate-400 hover:text-slate-600'}`}
                                                onClick={() => { setMode('summary'); setAiMsg(''); }}
                                            >
                                                <Bot className="w-4 h-4" />
                                                AI æ‘˜è¦
                                            </button>
                                        </div>

                                        {/* Input Area */}
                                        <div className="bg-white p-1">
                                            {mode === 'range' ? (
                                                <div className="space-y-4 animate-fadeIn">
                                                    <p className="text-slate-600 text-sm">æå–é€£çºŒé é¢ç‚ºå–®ä¸€æª”æ¡ˆã€‚</p>

                                                    <div className="flex items-center gap-4">
                                                        <div className="flex-1">
                                                            <label className="block text-sm font-medium text-slate-700 mb-1">èµ·å§‹é </label>
                                                            <input
                                                                type="number"
                                                                min="1"
                                                                max={pageCount}
                                                                value={rangeStart}
                                                                onChange={(e) => setRangeStart(e.target.value)}
                                                                className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all"
                                                                placeholder="1"
                                                            />
                                                        </div>
                                                        <span className="text-slate-400 mt-6">è‡³</span>
                                                        <div className="flex-1">
                                                            <label className="block text-sm font-medium text-slate-700 mb-1">çµæŸé </label>
                                                            <input
                                                                type="number"
                                                                min="1"
                                                                max={pageCount}
                                                                value={rangeEnd}
                                                                onChange={(e) => setRangeEnd(e.target.value)}
                                                                className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all"
                                                                placeholder={pageCount}
                                                            />
                                                        </div>
                                                    </div>
                                                </div>
                                            ) : mode === 'individual' ? (
                                                <div className="space-y-4 animate-fadeIn">
                                                    <p className="text-slate-600 text-sm">å°‡è¼¸å…¥çš„é ç¢¼<b>åˆ†åˆ¥åˆ‡å‰²</b>ä¸¦æ‰“åŒ…ä¸‹è¼‰ã€‚</p>

                                                    <div>
                                                        <label className="block text-sm font-medium text-slate-700 mb-1">é ç¢¼ (ä»¥é€—è™Ÿåˆ†éš”)</label>
                                                        <input
                                                            type="text"
                                                            value={individualPages}
                                                            onChange={(e) => setIndividualPages(e.target.value)}
                                                            className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all"
                                                            placeholder="ä¾‹å¦‚: 1, 3, 5, 8"
                                                        />
                                                    </div>
                                                </div>
                                            ) : (
                                                <div className="space-y-4 animate-fadeIn">
                                                    <p className="text-slate-600 text-sm">è¼¸å…¥è¦æ‘˜è¦çš„é ç¢¼ï¼ŒAI å°‡æå–<b>å®Œæ•´å…§å®¹</b>é€²è¡Œæ‘˜è¦ã€‚</p>

                                                    <div>
                                                        <label className="block text-sm font-medium text-slate-700 mb-1">æ‘˜è¦é ç¢¼ (æœ€å¤š 10 é )</label>
                                                        <input
                                                            type="text"
                                                            value={summaryPages}
                                                            onChange={(e) => setSummaryPages(e.target.value)}
                                                            className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition-all"
                                                            placeholder="ä¾‹å¦‚: 1-5, 8, 10-12ï¼ˆæ”¯æ´å–®é èˆ‡é€£çºŒé ï¼‰"
                                                        />
                                                        <p className="text-[10px] text-slate-400 mt-1">æ”¯æ´ "1, 3, 5"(å–®é ) æˆ– "1-5"(é€£çºŒé ) æ ¼å¼</p>
                                                    </div>

                                                    <button
                                                        onClick={handleAiSummarize}
                                                        disabled={isAiProcessing || !summaryPages}
                                                        className="w-full py-3 rounded-lg text-white font-bold flex items-center justify-center gap-2 transition-all bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed"
                                                    >
                                                        {isAiProcessing ? (
                                                            <>
                                                                <Loader2 className="w-5 h-5 animate-spin" />
                                                                æ‘˜è¦ä¸­...
                                                            </>
                                                        ) : (
                                                            <>
                                                                <Sparkles className="w-5 h-5" />
                                                                åŸ·è¡Œ AI æ‘˜è¦
                                                            </>
                                                        )}
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* AI Message Area */}
                                    {(isAiProcessing || aiMsg) && (
                                        <div className={`p-4 rounded-lg border ${isAiProcessing ? 'bg-purple-50 border-purple-100' : 'bg-slate-50 border-slate-200'} animate-fadeIn`}>
                                            <div className="flex items-start gap-3">
                                                {isAiProcessing ? <Loader2 className="w-5 h-5 text-purple-600 animate-spin mt-0.5" /> : <MessageSquare className="w-5 h-5 text-purple-600 mt-0.5" />}
                                                <div className="flex-1">
                                                    {isAiProcessing ? (
                                                        <p className="text-sm text-purple-700 font-medium">{aiMsg}</p>
                                                    ) : (
                                                        <div className="text-sm text-slate-700 whitespace-pre-wrap font-medium leading-relaxed">
                                                            <span className="text-purple-700 font-bold block mb-1">Gemini AI å›æ‡‰ï¼š</span>
                                                            {aiMsg}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Status Messages */}
                                    {statusMsg.text && (
                                        <div className={`p-4 rounded-lg flex items-center gap-3 ${statusMsg.type === 'error' ? 'bg-red-50 text-red-700 border border-red-100' : 'bg-green-50 text-green-700 border border-green-100'} animate-fadeIn`}>
                                            {statusMsg.type === 'error' ? <AlertCircle className="w-5 h-5 shrink-0" /> : <CheckCircle className="w-5 h-5 shrink-0" />}
                                            <span className="text-sm font-medium">{statusMsg.text}</span>
                                        </div>
                                    )}

                                    {/* Main Action Button - åªåœ¨åˆ‡å‰²æ¨¡å¼ä¸‹é¡¯ç¤º */}
                                    {mode !== 'summary' && (
                                        <button
                                            onClick={handleSplit}
                                            disabled={isProcessing || isAiProcessing}
                                            className={`w-full py-4 rounded-xl text-white font-bold text-lg shadow-lg flex items-center justify-center gap-3 transition-all transform active:scale-[0.98]
                                                ${isProcessing || isAiProcessing
                                                    ? 'bg-slate-400 cursor-not-allowed'
                                                    : 'bg-indigo-600 hover:bg-indigo-700 hover:shadow-indigo-200'
                                                }`}
                                        >
                                            {isProcessing ? (
                                                <>
                                                    <Loader2 className="w-6 h-6 animate-spin" />
                                                    è™•ç†ä¸­...
                                                </>
                                            ) : (
                                                <>
                                                    <Download className="w-6 h-6" />
                                                    {mode === 'range' ? 'ä¸‹è¼‰åˆ‡å‰²å¾Œçš„ PDF' : 'ä¸‹è¼‰ç¨ç«‹é é¢ (ZIP)'}
                                                </>
                                            )}
                                        </button>
                                    )}
                                </div>
                            )}
                        </div>

                        <div className="bg-slate-50 p-4 text-center border-t border-slate-100">
                            <p className="text-xs text-slate-400">
                                ğŸ”’ <b>æ‚¨çš„æª”æ¡ˆå®Œå…¨å®‰å…¨</b> â€” æ­¤ç‚ºå–®æª”ç‰ˆå·¥å…·ï¼Œæ‰€æœ‰ PDF è™•ç†çš†åœ¨ç€è¦½å™¨æœ¬åœ°å®Œæˆï¼Œæª”æ¡ˆä¸æœƒä¸Šå‚³è‡³ä»»ä½•ä¼ºæœå™¨ã€‚
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PDFSplitter />);
    </script>
</body>

</html>